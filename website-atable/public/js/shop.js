function redirect(){swal("Rester sur le shop ou aller au panier ?",{buttons:{cancel:"Shop",catch:{text:"Panier",value:"panier"}}}).then(e=>{switch(e){case"panier":window.location=$webUrl+"/cart";break;default:window.location=$webUrl+"/shop"}})}function update_command(e){var a=window.localStorage.getItem("BearerToken");$.ajax({url:$apiUrl+"/command/"+window.localStorage.getItem("command_id"),headers:{Authorization:`Bearer ${a}`},type:"PUT",data:e,dataType:"json",success:function(e){console.log(e),redirect()}})}function put_command_price(e){var a=0,o=e.price,t=window.localStorage.getItem("BearerToken");$.ajax({url:$apiUrl+"/command/"+window.localStorage.getItem("command_id"),headers:{Authorization:`Bearer ${t}`},type:"GET",dataType:"json",success:function(e){if(a=e.price,1==window.location.href.includes($webUrl+"/productsingle"))var t=parseInt(document.getElementById("quantity").value,10);else t=1;let n={price:parseInt(o,10)*t+parseInt(a,10)};var c=window.localStorage.getItem("command_qty");window.localStorage.setItem("command_qty",parseInt(c,10)+parseInt(t,10));c=window.localStorage.getItem("command_qty");$("#cart_icon").replaceWith(c),update_command(n),console.log(e)},error:function(e){console.log(e)}})}function add_new_item(e){var a=window.localStorage.getItem("BearerToken");$.ajax({url:$apiUrl+"/command_dish",headers:{Authorization:`Bearer ${a}`},type:"POST",data:e,dataType:"json",success:function(e){if(1==window.location.href.includes($webUrl+"/productsingle")){let o={quantity:parseInt(document.getElementById("quantity").value,10)};$.ajax({url:$apiUrl+"/command_dish/"+e.id,headers:{Authorization:`Bearer ${a}`},type:"PUT",data:o,dataType:"json",success:function(e){console.log(e)},error:function(e){console.log(e)}})}put_command_price(e),console.log(e)},error:function(e){console.log(e)}})}function update_quantity(e,a){for(var o=window.localStorage.getItem("BearerToken"),t=!1,n=0;n<Object.keys(e).length;n++)if(e[n].dish_id==a.dish_id&&e[n].command_id==a.command_id){if(t=!0,1==window.location.href.includes($webUrl+"/productsingle"))var c=parseInt(document.getElementById("quantity").value,10);else c=1;let a={quantity:parseInt(e[n].quantity,10)+c};$.ajax({url:$apiUrl+"/command_dish/"+e[n].id,headers:{Authorization:`Bearer ${o}`},type:"PUT",data:a,dataType:"json",success:function(e){put_command_price(e),console.log(e)},error:function(e){console.log(e)}})}0==t&&add_new_item(a)}function add_dish_to_cart(e){var a=window.localStorage.getItem("BearerToken");$.ajax({url:$apiUrl+"/command_dish",headers:{Authorization:`Bearer ${a}`},type:"GET",dataType:"json",success:function(a){update_quantity(a,e),console.log(a)},error:function(e){console.log(e)}})}function add_dish_to_command(e){var a=window.localStorage.getItem("BearerToken");$.ajax({url:$apiUrl+"/dish/"+e,headers:{Authorization:`Bearer ${a}`},type:"GET",dataType:"json",success:function(a){add_dish_to_cart({command_id:window.localStorage.getItem("command_id"),dish_id:e,price:a.price})},error:function(e){console.log(e)}})}function create_command(){var e=window.localStorage.getItem("BearerToken");window.localStorage.setItem("command_qty",0);let a={customer_id:window.localStorage.getItem("customer_id"),price:0,command_status_id:0};$.ajax({url:$apiUrl+"/command",headers:{Authorization:`Bearer ${e}`},type:"POST",data:a,async:!1,dataType:"json",success:function(e){console.log(e),window.localStorage.removeItem("command_id"),window.localStorage.setItem("command_id",e.id)},error:function(e){console.log(e)}})}function create_and_add(e){create_command(),add_dish_to_command(e)}function check_and_add(e,a){for(var o=0;o<Object.keys(a).length;o++){var t=0;a[o].customer_id==window.localStorage.getItem("customer_id")&&0==a[o].command_status_id&&(window.localStorage.removeItem("command_id"),window.localStorage.setItem("command_id",a[o].id),add_dish_to_command(e),t=1)}0==t&&create_and_add(e)}function add_cart(e){var a=window.localStorage.getItem("BearerToken");$.ajax({type:"GET",url:$apiUrl+"/command",headers:{Authorization:`Bearer ${a}`},success:function(a){0==a.length&&create_and_add(e),check_and_add(e,a)},error:function(e){console.log(e)}}),swal("Hop!","Item ajouté au panier!","success")}function show_single(e){window.location=$webUrl+"/productsingle?id="+e}function build_shop(e){var a;$("#dish_list").empty();for(var o=0;o<Object.keys(e).length;o++){var t='<a class="img-prod" id="'+e[o].id+'" onclick="show_single(this.id)"><img class="img-fluid" src="images/'+e[o].photo_path+'" alt="Colorlib Template"><div class="overlay"></div></a>';e[o].photo_content&&(t='<a class="img-prod" id="'+e[o].id+'" onclick="show_single(this.id)"><img class="img-fluid" src="data:image/jpeg;base64,'+e[o].photo_content+'" alt="Colorlib Template"><div class="overlay"></div></a>');a='<div class="col-md-6 col-lg-3"><div class="product">'+t+'<div class="text py-3 pb-4 px-3 text-center">'+('<h3><a href="#">'+e[o].name+"</a></h3>")+('<div class="d-flex"><div class="pricing"><p class="price"><span class="mr-2 price-dc"></span><span class="price-sale">'+e[o].price+"€</span></p></div></div>")+'<div class="bottom-area d-flex px-3"><div class="m-auto d-flex"><a href="#" class="add-to-cart d-flex justify-content-center align-items-center text-center"><span><i class="ion-ios-menu"></i></span></a>'+('<a type=button price="'+e[o].price+'" id="'+e[o].id+'" onclick="add_cart(this.id)" class="btn btn-primary"><span><i class="ion-ios-cart"></i></span></a>')+'<a href="#" class="heart d-flex justify-content-center align-items-center "><span><i class="ion-ios-heart"></i></span></a></div></div></div></div></div>',$("#dish_list").append(a)}}$(document).ready(function(){var e=window.localStorage.getItem("BearerToken");$.ajax({url:$apiUrl+"/dish",headers:{Authorization:`Bearer ${e}`},type:"GET",dataType:"json",success:function(e){build_shop(e)}}),$("#search_shop").click(function(){$.ajax({url:$apiUrl+"/shop_search/"+$("#search_name").val(),type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#cost_ascend").click(function(){$.ajax({url:$apiUrl+"/cost_ascend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#cost_descend").click(function(){$.ajax({url:$apiUrl+"/cost_descend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#name_ascend").click(function(){$.ajax({type:"GET",url:$apiUrl+"/name_ascend",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#name_descend").click(function(){$.ajax({url:$apiUrl+"/name_descend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#time_ascend").click(function(){$.ajax({url:$apiUrl+"/time_ascend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#time_descend").click(function(){$.ajax({url:$apiUrl+"/time_descend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#stock_ascend").click(function(){$.ajax({url:$apiUrl+"/stock_ascend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})}),$("#stock_descend").click(function(){$.ajax({url:$apiUrl+"/stock_descend",type:"GET",dataType:"json",success:function(e){console.log(e),build_shop(e)}})})});
